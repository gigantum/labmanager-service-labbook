machine:
  python:
    version: 3.6.1

dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install build-essential libsnappy-dev
    - mkdir ~/leveldb; cd ~/leveldb; git clone https://github.com/google/leveldb.git; cd leveldb/; make;
    - sudo scp ~/leveldb/leveldb/out-static/lib* ~/leveldb/leveldb/out-shared/lib* /usr/local/lib/
    - cd ~/leveldb/leveldb/include/; sudo scp -r leveldb /usr/local/include/; sudo ldconfig
    - git config --global user.email "noreply@gigantum.io"
    - git config --global user.name "CircleCI"

  override:
    - pip install -r requirements.txt
    - pip install git+https://github.com/gigantum/labmanager-common.git
    - pip install coveralls pytest-cov

test:
  override:
    - pytest --cov=lmsrvlabbook lmsrvlabbook/
    - pytest --cov=lmsrvnotes --cov-append lmsrvnotes/
    - coveralls